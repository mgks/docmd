<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docmd WASM Demo</title>
    <script src="docmd-wasm.js"></script>
    <style>
        body { font-family: system-ui, sans-serif; display: flex; flex-direction: column; height: 100vh; margin: 0; }
        header { padding: 1rem; background: #333; color: white; display: flex; justify-content: space-between; align-items: center; }
        main { flex: 1; display: flex; overflow: hidden; }
        .editor, .preview { flex: 1; display: flex; flex-direction: column; }
        textarea { flex: 1; padding: 1rem; font-family: monospace; border: none; resize: none; background: #f4f4f4; }
        iframe { flex: 1; border: none; background: white; }
        .controls { padding: 0.5rem; background: #eee; border-bottom: 1px solid #ddd; }
    </style>
</head>
<body>
    <header>
        <h1>Docmd Browser/WASM Demo</h1>
        <button onclick="render()">Render</button>
    </header>
    <main>
        <div class="editor">
            <div class="controls">Markdown Input</div>
            <textarea id="input">
---
title: Hello World
description: Generated in the browser!
---

# Hello Docmd!

This site was generated **entirely in your browser** using `docmd-wasm.js`.

## Features
- Full Markdown support
- Frontmatter parsing
- Templates included
- No server required

```javascript
console.log('It works!');
```
            </textarea>
        </div>
        <div class="preview">
            <div class="controls">HTML Preview</div>
            <iframe id="output"></iframe>
        </div>
    </main>
    <script>
        const input = document.getElementById('input');
        const output = document.getElementById('output');

        function render() {
            try {
                const markdown = input.value;
                const config = { 
                    siteTitle: 'Docmd WASM',
                    theme: { defaultMode: 'light' }
                };
                
                // docmd global is exposed by docmd-wasm.js
                const html = docmd.compile(markdown, config, {
                    currentPath: '/demo'
                });

                const blob = new Blob([html], { type: 'text/html' });
                output.src = URL.createObjectURL(blob);
            } catch (e) {
                console.error(e);
                output.srcdoc = `<h1>Error</h1><pre>${e.message}</pre>`;
            }
        }

        // Initial render
        render();

        // Auto render on change (debounced)
        let timeout;
        input.addEventListener('input', () => {
            clearTimeout(timeout);
            timeout = setTimeout(render, 500);
        });
    </script>
</body>
</html>
